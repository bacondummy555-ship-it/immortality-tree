<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Immortality Tree - Idle RPG</title>
    <style>
        :root {
            --ink-black: #2c2c2c;
            --parchment: #f4ece1;
            --legendary: #d4af37;
            --epic: #9b59b6;
            --rare: #3498db;
        }

        body {
            background-color: var(--parchment);
            font-family: 'Segoe UI', serif;
            color: var(--ink-black);
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            overflow: hidden;
        }

        #game-container {
            width: 100%;
            max-width: 500px;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 20px;
            box-sizing: border-box;
            border: 2px solid var(--ink-black);
        }

        .stats-bar {
            display: flex;
            justify-content: space-between;
            border-bottom: 2px solid var(--ink-black);
            padding-bottom: 10px;
        }

        #tree-area {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        #divine-tree {
            width: 200px;
            height: 250px;
            background: linear-gradient(to top, #4b3621, #2d5a27);
            border-radius: 50% 50% 20% 20%;
            cursor: pointer;
            transition: transform 0.1s;
            box-shadow: 0 0 20px rgba(255,255,255,0.5);
            display: flex;
            align-items: flex-end;
            justify-content: center;
        }

        #divine-tree:active { transform: scale(0.95) rotate(2deg); }

        #animal {
            font-size: 50px;
            margin-bottom: -10px;
        }

        /* Compare Window */
        #compare-modal {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border: 3px solid var(--ink-black);
            padding: 20px;
            z-index: 100;
            width: 80%;
            box-shadow: 10px 10px 0px rgba(0,0,0,0.1);
        }

        .compare-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 15px 0;
        }

        .stat-up { color: green; font-weight: bold; }
        .stat-down { color: red; }

        button {
            background: var(--ink-black);
            color: white;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            font-family: inherit;
        }

        #auto-chop-btn {
            background: #888;
            margin-top: 10px;
        }

        .rarity-Common { color: #7f8c8d; }
        .rarity-Rare { color: var(--rare); }
        .rarity-Epic { color: var(--epic); }
        .rarity-Legendary { color: var(--legendary); font-weight: bold; }
    </style>
</head>
<body>

<div id="game-container">
    <div class="stats-bar">
        <div>Level: <span id="lvl">1</span></div>
        <div>EXP: <span id="exp">0</span>/100</div>
    </div>

    <div id="tree-area">
        <div id="divine-tree" onclick="chop()">
            <div id="animal">üê±</div>
        </div>
        <button id="auto-chop-btn" onclick="toggleAuto()" disabled>Auto-Chop (Unlock Lvl 5)</button>
    </div>

    <div id="equipment-slots">
        <strong>Current Stats:</strong> 
        Attack: <span id="p-atk">5</span> | HP: <span id="p-hp">50</span>
    </div>

    <div id="compare-modal">
        <h3 id="item-name">New Item Found!</h3>
        <p id="item-rarity"></p>
        <div class="compare-grid">
            <div>
                <strong>Current</strong><br>
                Atk: <span id="curr-atk">0</span><br>
                HP: <span id="curr-hp">0</span>
            </div>
            <div>
                <strong>New</strong><br>
                Atk: <span id="new-atk">0</span><br>
                HP: <span id="new-hp">0</span>
            </div>
        </div>
        <div style="display:flex; justify-content: space-around;">
            <button onclick="equipItem()">Equip</button>
            <button onclick="closeModal()" style="background:#888">Discard</button>
        </div>
    </div>
</div>

<script>
    let player = {
        lvl: 1,
        exp: 0,
        expNeeded: 100,
        atk: 5,
        hp: 50,
        autoChop: false,
        equipment: {
            Weapon: { name: "Stick", atk: 2, hp: 0, rarity: "Common" },
            Armor: { name: "Rags", atk: 0, hp: 10, rarity: "Common" },
            Accessory: { name: "Stone", atk: 1, hp: 5, rarity: "Common" }
        }
    };

    let pendingItem = null;
    let autoInterval = null;

    const types = ["Weapon", "Armor", "Accessory"];
    const rarities = [
        { name: "Common", chance: 0.7, mult: 1 },
        { name: "Rare", chance: 0.2, mult: 2.5 },
        { name: "Epic", chance: 0.08, mult: 6 },
        { name: "Legendary", chance: 0.02, mult: 15 }
    ];

    function chop() {
        // Gain EXP
        player.exp += 20;
        if(player.exp >= player.expNeeded) {
            player.lvl++;
            player.exp = 0;
            player.expNeeded *= 1.5;
            checkUnlocks();
        }
        
        generateItem();
        updateUI();
    }

    function generateItem() {
        const type = types[Math.floor(Math.random() * types.length)];
        const roll = Math.random();
        let rarity = rarities[0];
        
        let cumulative = 0;
        for (let r of rarities) {
            cumulative += r.chance;
            if (roll < cumulative) {
                rarity = r;
                break;
            }
        }

        pendingItem = {
            type: type,
            rarity: rarity.name,
            atk: Math.floor(Math.random() * 5 * rarity.mult * player.lvl),
            hp: Math.floor(Math.random() * 20 * rarity.mult * player.lvl),
            name: `${rarity.name} ${type}`
        };

        showCompare();
    }

    function showCompare() {
        const current = player.equipment[pendingItem.type];
        document.getElementById('compare-modal').style.display = 'block';
        document.getElementById('item-name').innerText = pendingItem.name;
        document.getElementById('item-rarity').innerText = pendingItem.rarity;
        document.getElementById('item-rarity').className = `rarity-${pendingItem.rarity}`;
        
        document.getElementById('curr-atk').innerText = current.atk;
        document.getElementById('curr-hp').innerText = current.hp;
        
        document.getElementById('new-atk').innerText = pendingItem.atk;
        document.getElementById('new-hp').innerText = pendingItem.hp;

        // Visual coloring
        document.getElementById('new-atk').className = pendingItem.atk > current.atk ? 'stat-up' : 'stat-down';
        document.getElementById('new-hp').className = pendingItem.hp > current.hp ? 'stat-up' : 'stat-down';
    }

    function equipItem() {
        player.equipment[pendingItem.type] = pendingItem;
        calculateStats();
        closeModal();
    }

    function calculateStats() {
        player.atk = 5 + player.equipment.Weapon.atk + player.equipment.Armor.atk + player.equipment.Accessory.atk;
        player.hp = 50 + player.equipment.Weapon.hp + player.equipment.Armor.hp + player.equipment.Accessory.hp;
        updateUI();
    }

    function closeModal() {
        document.getElementById('compare-modal').style.display = 'none';
        pendingItem = null;
    }

    function checkUnlocks() {
        if(player.lvl >= 5) {
            const btn = document.getElementById('auto-chop-btn');
            btn.disabled = false;
            btn.innerText = "Start Auto-Chop";
            btn.style.background = "#2d5a27";
        }
    }

    function toggleAuto() {
        player.autoChop = !player.autoChop;
        if(player.autoChop) {
            autoInterval = setInterval(chop, 2000);
            document.getElementById('auto-chop-btn').innerText = "Stop Auto-Chop";
        } else {
            clearInterval(autoInterval);
            document.getElementById('auto-chop-btn').innerText = "Start Auto-Chop";
        }
    }

    function updateUI() {
        document.getElementById('lvl').innerText = Math.floor(player.lvl);
        document.getElementById('exp').innerText = Math.floor(player.exp);
        document.getElementById('p-atk').innerText = player.atk;
        document.getElementById('p-hp').innerText = player.hp;
    }

    updateUI();
</script>
</body>
</html>
